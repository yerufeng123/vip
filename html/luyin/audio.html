<!DOCTYPE html>
<html lang="zh-cn">
  <head>
    <meta charset="utf-8">
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="format-detection" content="telephone=no">
    <meta name="format-detection" content="email=no">
    <meta id="viewport" name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black"/>
    <!-- UC强制全屏 --><meta name="full-screen" content="yes">
    <!-- UC应用模式 --><meta name="browsermode" content="application">
    <!-- QQ强制全屏 --><meta name="x5-fullscreen" content="true">
    <!-- QQ应用模式 --><meta name="x5-page-mode" content="app">
    <title>猴年庆新春</title>
    <style>
      </style>
    <link rel="stylesheet" href="css/common.css">
  </head>
  <body>
  	<div id="wrap" class="">
  		<div class="page">
  			<ul class="pageList">
	  			<li class="pageLi userPage"  style="background-image:url(img/photo3.jpg)">
	  				<div class="userMask"></div>
  					<div class="myPhoto" style="background-image:url(img/photo.jpg)"></div>
	  				<span class="myName">飞奔的五花肉</span>
	  				<!-- 上传完成后会添加data-audio属性 -->
	  				<!-- <div class="myAudio" data-audio="12345"></div> -->
	  				<div class="myAudio" data-audio="12345"></div>
	  			</li>
	  			<li class="pageLi recordPage">
	  				<ul class="recordList">
	  					<li class="recordLi">
	  						<div class="recordMark"></div>
	  						<div class="recordMain" data-audio="">
	  							2016.02.04
	  							<span class="recordDelete">删除</span>
	  							<span class="recordUpload"></span>
	  						</div>
	  					</li>
	  					<li class="recordLi">
	  						<div class="recordMark"></div>
	  						<div class="recordMain" data-audio="">
	  							2016.02.04
	  							<span class="recordDelete">删除</span>
	  							<span class="recordUpload"></span>
	  						</div>
	  					</li>
	  					<li class="recordLi">
	  						<div class="recordMark"></div>
	  						<div class="recordMain" data-audio="">
	  							2016.02.04
	  							<span class="recordDelete">删除</span>
	  							<span class="recordUpload"></span>
	  						</div>
	  					</li>
	  					<li class="recordLi">
	  						<div class="recordMark"></div>
	  						<div class="recordMain" data-audio="">
	  							2016.02.04
	  							<span class="recordDelete">删除</span>
	  							<span class="recordUpload"></span>
	  						</div>
	  					</li>
	  					<li class="recordLi">
	  						<div class="recordMark"></div>
	  						<div class="recordMain" data-audio="">
	  							2016.02.04
	  							<span class="recordDelete">删除</span>
	  							<span class="recordUpload"></span>
	  						</div>
	  					</li>
	  					<li class="recordLi">
	  						<div class="recordMark"></div>
	  						<div class="recordMain" data-audio="">
	  							2016.02.04
	  							<span class="recordDelete">删除</span>
	  							<span class="recordUpload"></span>
	  						</div>
	  					</li>
	  					<li class="recordLi">
	  						<div class="recordMark"></div>
	  						<div class="recordMain" data-audio="">
	  							2016.02.04
	  							<span class="recordDelete">删除</span>
	  							<span class="recordUpload"></span>
	  						</div>
	  					</li>
	  					<li class="recordLi">
	  						<div class="recordMark"></div>
	  						<div class="recordMain" data-audio="">
	  							2016.02.04
	  							<span class="recordDelete">删除</span>
	  							<span class="recordUpload"></span>
	  						</div>
	  					</li>
	  					<li class="recordLi">
	  						<div class="recordMark"></div>
	  						<div class="recordMain" data-audio="">
	  							2016.02.04
	  							<span class="recordDelete">删除</span>
	  							<span class="recordUpload finish"></span>
	  						</div>
	  					</li>
	  					<li class="recordLi">
	  						<div class="recordMark"></div>
	  						<div class="recordMain" data-audio="">
	  							2016.02.04
	  							<span class="recordDelete">删除</span>
	  							<span class="recordUpload load"></span>
	  						</div>
	  					</li>
	  				</ul>
	  				<div class="recordHead">
	  					<div class="recordBtn">录音</div>
	  				</div>
	  				<div class="recordTip">最多录制十条语音，请及时删除</div>
	  			</li>
	  			<li class="pageLi audioPage show">
	  				<div class="search">
	  					<div class="searchByname">搜索</div>
	  				</div>
					<dl class="audioList">
						<dt class="audioTit" id="D">D</dt>
						<dd class="audioLi" data-down="" data-pic="img/photo3.jpg" data-photo="img/photo.jpg" data-name="逗B班长">
							<div class="audioPic" style="background-image:url(img/photo.jpg)"></div>
						</dd>
						<dt class="audioTit" id="F">F</dt>
						<dd class="audioLi" data-down="" data-pic="img/photo3.jpg" data-photo="img/photo.jpg" data-name="飞奔的五花肉">
							<div class="audioPic" style="background-image:url(img/photo.jpg)" ></div>
						</dd>
						<dd class="audioLi" data-down="" data-pic="img/photo3.jpg" data-photo="img/photo.jpg" data-name="飞奔的五花肉">
							<div class="audioPic" style="background-image:url(img/photo.jpg)" ></div>
						</dd>
						<dd class="audioLi" data-down="" data-pic="img/photo3.jpg" data-photo="img/photo.jpg" data-name="飞奔的五花肉">
							<div class="audioPic" style="background-image:url(img/photo.jpg)" ></div>
						</dd>
						<dd class="audioLi" data-down="" data-pic="img/photo3.jpg" data-photo="img/photo.jpg" data-name="飞奔的五花肉">
							<div class="audioPic" style="background-image:url(img/photo.jpg)" ></div>
						</dd>
						<dt class="audioTit" id="L">L</dt>
						<dd class="audioLi" data-down="" data-pic="img/photo3.jpg" data-photo="img/photo.jpg" data-name="LT">
							<div class="audioPic" style="background-image:url(img/photo.jpg)"></div>
						</dd>
						<dt class="audioTit" id="M">M</dt>
						<dd class="audioLi" data-down="" data-pic="img/photo3.jpg" data-photo="img/photo.jpg" data-name="漫陀螺">
							<div class="audioPic" style="background-image:url(img/photo.jpg)"></div>
						</dd>
						<dd class="audioLi" data-down="" data-pic="img/photo3.jpg" data-photo="img/photo.jpg" data-name="漫陀螺">
							<div class="audioPic" style="background-image:url(img/photo.jpg)"></div>
						</dd>
						<dd class="audioLi" data-down="" data-pic="img/photo3.jpg" data-photo="img/photo.jpg" data-name="漫陀螺">
							<div class="audioPic" style="background-image:url(img/photo.jpg)"></div>
						</dd>
						<dd class="audioLi" data-down="" data-pic="img/photo3.jpg" data-photo="img/photo.jpg" data-name="漫陀螺">
							<div class="audioPic" style="background-image:url(img/photo.jpg)"></div>
						</dd>
						<dd class="audioLi" data-down="" data-pic="img/photo3.jpg" data-photo="img/photo.jpg" data-name="漫陀螺">
							<div class="audioPic" style="background-image:url(img/photo.jpg)"></div>
						</dd>
					</dl>
					<div class="searchList">
						<a href="#D" class="searchLi">D</a>
						<a href="#F" class="searchLi">F</a>
						<a href="#L" class="searchLi">L</a>
						<a href="#M" class="searchLi">M</a>
					</div>
	  			</li>
	  			<li class="pageLi sharePage"></li>
	  		</ul>
	  		<ul class="tabList">
	  			<li class="tabLi">
	  				<div class="icons user"></div>
	  				我的信息
	  			</li>
	  			<li class="tabLi">
	  				<div class="icons record"></div>
	  				语音录制
	  			</li>
	  			<li class="tabLi click">
	  				<div class="icons audio"></div>
	  				通信录
	  			</li>
	  			<li class="tabshare">
	  				<div class="icons share"></div>
	  				分享
	  			</li>
	  		</ul>
  		</div>
  		<div class="audioShow" style="background-image:url(img/photo3.jpg)">
  			<div class="audioMask"></div>
  			<div class="audioP" style="background-image:url(img/photo.jpg)"></div>
  			<div class="audioN">飞奔的五花肉</div>
  			<div class="audioTip">正在连接中....</div>
  			<ul class="audioB">
  				<li class="icons audioOff"></li>
  			</ul>
  		</div>
  		<div class="tips">你好哈</div>
  	</div>
  	<!-- 加载动画 -->
  	<div class="maskLoad" style="display:none"></div>
  	<input type="hidden" id="playId">
    <script type="text/javascript" src="http://r1.ykimg.com/0510000055FF635467BC3D17B909FA5D.js">//JQ</script>
    <script src="js/jweixin-1.0.0.js"></script>

    <script type="text/javascript">
    wx.config({
	    debug: true,
	    appId: 'wx6e7ae31a2156727a',
	    timestamp: 1453734128,
	    nonceStr: 'MQ12vmZOM6b4ZHmJ',
	    signature: 'dcb0bc3674a2c069f896875ee9d4bfc58ab7450d',
	    jsApiList: [
	        // 所有要调用的 API 都要加到这个列表中
	        'startRecord',
	        'stopRecord',
	        'pauseVoice',
	        'playVoice',
	        'stopVoice',
	        'uploadVoice',
	        'downloadVoice',
	        'onVoiceRecordEnd',
	        'onVoicePlayEnd',
	        'translateVoice',
	    ]
	});
	wx.ready(function () {
	    //监听录音自动停止接口
	    wx.onVoiceRecordEnd({
	        // 录音时间超过一分钟没有停止的时候会执行 complete 回调
	        complete: function (res) {
	            var localId = res.localId;
	            alert('录音超时');
	        }
	    });

	    //监听语音播放完毕接口
	    wx.onVoicePlayEnd({
	        success: function (res) {
	        	$('#playId').value = 0;
	        	$('#wrap').removeClass('rotate');
	        }
	    });
	});

    $(document).ready(function(){
    	//tab切换
    	$('.tabLi').on('click',function(e){
    		$(this).addClass('click').siblings('.tabLi').removeClass('click');
    		var _index = $(this).index();
    		$('.pageLi').removeClass('show').eq(_index).addClass('show');
    		e.stopPropagation();
      		e.preventDefault();
    	})
    	$('.tabshare').on('click',function(e){
    		alert('分享接口')
    	})
    	$('.myPhoto').on('click',function(e){
    		alert('更换头像');
    	})
    	$('.userMask').on('click',function(e){
    		alert('更换背景');
    	})
    	//录音管理
    	$('.recordList').on('click',function(e){
    		var aim = e.target;
    		var parent = $(aim).parents('.recordLi');
    		if($(aim).hasClass('recordDelete')){
    			parent.remove();
    		}else if($(aim).hasClass('recordMain')){
    			var audioId = parent.attr('data-audio')||0;
    			if(audioId){
    				play(audioId);
    			}else{
    				alert("无法播放语音，请试着重新打开语音")
    			}
    		}else if($(aim).hasClass('recordUpload')){
    			var audioId = parent.attr('data-audio')||0;
    			if(audioId){
    				upload(audioId);
    				$('.maskLoad').show();
    			}else{
    				alert("无法上传，请稍后再试");
    			}
    		}
    	})
    	//录音
    	$('.recordBtn').on('click',function(){
    		if($(this).hasClass('stop')){
    			wx.stopRecord({
                    success: function (res) {
                        var localId = res.localId;
                        var test = '<li class="recordLi"><div class="recordMark"></div><div class="recordMain" data-audio="'+localId+'">2016.02.04<span class="recordDelete">删除</span><span class="recordUpload finish" data-upload="'+localId+'"></span></div></li>';
                        $('.recordList').append(test);
                    },
                    error:function(){
                    	alert("无法录音");
                    }
                });
    		}else{
    			wx.startRecord();
    		}
    		$(this).toggleClass('stop');
    	})
    	
    	//我的录音
    	$('.myAudio').on('click',function(e){
    		if($(this).attr('data-audio')){
    			var audioId = $(this).attr('data-audio')||0;
    			if(audioId){
    				play(audioId)
    			}else{
    				alert("无法播放")
    			}
    		}else{
    			$('.tabLi').removeClass('click').eq(1).addClass('click');
    			$('.pageLi').removeClass('show').eq(1).addClass('show');
    		}
    		e.stopPropagation();
      		e.preventDefault();
    	})

    	//点击好友播放
    	$('.audioLi').on('click',function(e){
    		$('#wrap').addClass('rotate')
    		var audioId = $(this).attr('data-down')||0;
    		if(audioId){
    			wx.downloadVoice({
		            serverId:audioId, 
		            isShowProgressTips: 1, // 默认为1，显示进度提示
		            success: function (res) {
		                play(res.localId)
		            }
		        });
    		}
    		$('.audioN').html($(this).attr('data-name'));
    		$('.audioP').css('background-image','url('+$(this).attr('data-photo')+')');
    		$('.audioShow').css('background-image','url('+$(this).attr('data-pic')+')');
    		$('.audioTip').html('正在连接中...')
    	})
    	//停止播放
    	$('.audioOff').on('click',function(){
    		$('#wrap').removeClass('rotate');
    		stop2($('#playId').value);
    	})
    	init()

    	//初始化自己的音频
    	function init(){
    		var audioId = $('.myAudio').attr('data-audio')||0;
    		if(audioId){
    			wx.downloadVoice({
		            serverId:audioId, 
		            isShowProgressTips: 1, // 默认为1，显示进度提示
		            success: function (res) {
		            	$('.myAudio').attr('data-audio',res.localId);
		            }
		        });
    		}
    	}
    })
	

	//下载语音
    function download(id){
        wx.downloadVoice({
            serverId:id, 
            isShowProgressTips: 1, // 默认为1，显示进度提示
            success: function (res) {
            	play(res.localId);
            	$('.audioTip').html('');
            },
            error:function(){
            	$('.audioTip').html('连接失败');
            }
        });
    }
    //上传语音
    function upload(id) {
        wx.uploadVoice({
            localId:id,
            isShowProgressTips: 1,
            success: function (res) {
            	$('.maskLoad').hide();
            	$('.myAudio').attr('data-audio',id);
            	alert(id+"已经上传到"+res.serverId);
            }
        });
    }
    //播放录音
    function play(id) {
        wx.playVoice({
            localId: id,
        });
        $('#playId').value = id;
    }
    //停止播放
    function stop2(id) {
        wx.stopVoice({
            localId: $('#localId').val(), // 需要停止的音频的本地ID，由stopRecord接口获得
        });
        $('#playId').value = 0;
    }
    function tip(str){
    	var text = div.tips
    }
    
    </script>
  </body>
</html>